# Billing Alarms

This is a CDK project written to create an easily shared way to quickly setup a budget for novice AWS users.

### It is of utmost importance to understand, this sets up alerts on levels of money billed, it does not enforce a spending limit.

## Prerequisites

1) Docker must be installed  
    [Docker install instructions can be found here](https://docs.docker.com/engine/install/)

2) You must have an AWS account  
    [Account creation guide can be found here](https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/)

3) Create an IAM user, with MFA, do not use your account root user.  (Keep your account root user credentials safe and secure)
And create a secret key for your IAM user.  
    [IAM user creation guide](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html)  
    [How to enable MFA on an IAM user](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_enable_virtual.html)  
    [How to create access keys](https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys)  
      
4) Optional: Install and configure the AWS CLI.  Also, install aws-mfa to help manage credentials for cli use.  
    [AWS CLI install instructions can be found here](https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html)  
    [AWS CLI configuration instructions can be found here](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html)    
    [AWS IAM user MFA setup instructions](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_enable_virtual.html)  
    [aws-mfa project](https://github.com/broamski/aws-mfa)  
    While this is technically optional, if you plan on having and using an AWS account, this is ideal for managing your 
    account and its credentials for the long term.
    
5) Create and download programmatic access keys for your IAM user.
    [Guide for creating programmtic access keys](https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys)  
    
6) Optional, if you installed the AWS CLI, you can now run aws configure and give it your keys, and it will store them in your user profile for you.
    [Guide for configuring AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html)   

### Setting up the config yaml
The config.yml file holds the billing alarm configuration.

You must edit this file to provide your phone number and/or email address.  
The file itself has comments that should make it pretty clear.

## Using the docker image

1) The docker image must first be built, by running the following command  
`docker build -t cdk:latest .`  
from the project root.

2) Now, use docker run to create a container, and we will mount the project into the container as well  BUT wait!  
    A) If you did the optional setup with the aws cli, you should mount ~/.aws into the container  
    `docker run -it -v $HOME/.aws/:/root/.aws/ -v ./:/src/ cdk:latest`   
    B)  If you did not do the AWS CLI setup, then you will need to set ENVIRONMENT values in the container holding your credentials  
    `docker run -it -v ./:/src/ --env AWS_ACCESS_KEY_ID=<your_access_key> --env AWS_SECRET_ACCESS_KEY=<your_secret_key> --env AWS_DEFAULT_REGION=<your_default_region> cdk:latest`
    
3)  You should now be running on an interactive terminal within the container.  
    If you used option B above, or used option A and are using a default profile, the next step is as simple as:  
    `cdk deploy`  
    If you used option A, and want to use a non-default profile simple add the profile flag:  
    `cdk deploy --profile <your_non_default_profile>`


## Python Setup, for non-docker use
(Please note this was mostly auto-generated by AWS CDK itself)

To manually create a virtualenv on MacOS and Linux:

```
$ python3 -m venv .env
```

After the init process completes and the virtualenv is created, you can use the following
step to activate your virtualenv.

```
$ source .env/bin/activate
```

If you are a Windows platform, you would activate the virtualenv like this:

```
% .env\Scripts\activate.bat
```

Once the virtualenv is activated, you can install the required dependencies.

```
$ pip install -r requirements.txt
```

At this point you can now synthesize the CloudFormation template for this code.

```
$ cdk synth
```

To add additional dependencies, for example other CDK libraries, just add
them to your `setup.py` file and rerun the `pip install -r requirements.txt`
command.

## Useful CDK commands

 * `cdk ls`          list all stacks in the app
 * `cdk synth`       emits the synthesized CloudFormation template
 * `cdk deploy`      deploy this stack to your default AWS account/region
 * `cdk diff`        compare deployed stack with current state
 * `cdk docs`        open CDK documentation

Enjoy!
